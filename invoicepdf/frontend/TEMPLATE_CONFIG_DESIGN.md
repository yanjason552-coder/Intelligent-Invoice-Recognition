# å•æ®æ¨¡æ¿é…ç½®è®¾è®¡æ€è·¯

## ğŸ“‹ ä¸€ã€å®šä½ä¸æ ¸å¿ƒæ¦‚å¿µ

### 1.1 äº§å“å®šä½
**ğŸ‘‰ "é•¿å¾—ä¸€æ ·çš„å‘ç¥¨"**

å•æ®æ¨¡æ¿é…ç½®ç”¨äºå®šä¹‰**å‘ç¥¨çš„ç‰ˆå¼/æ ·å¼**ï¼Œè¯†åˆ«ç³»ç»Ÿé€šè¿‡æ¨¡æ¿åŒ¹é…æ¥ç¡®å®šä½¿ç”¨å“ªä¸ªæ¨¡æ¿æ¥è¯†åˆ«å‘ç¥¨ã€‚

### 1.2 æ ¸å¿ƒæ¦‚å¿µåŒºåˆ†

| æ¦‚å¿µ | å®šä¹‰ | ä½œç”¨ |
|------|------|------|
| **Schema** | æ•°æ®ç»“æ„å®šä¹‰ | å®šä¹‰"AIè¦æŒ‰ä»€ä¹ˆç»“æ„ç†è§£å‘ç¥¨" |
| **Template** | ç‰ˆå¼/æ ·å¼å®šä¹‰ | å®šä¹‰"é•¿å¾—ä¸€æ ·çš„å‘ç¥¨" |
| **å…³ç³»** | Template ç»‘å®š Schema | Template å†³å®šåŒ¹é…ï¼ŒSchema å†³å®šæ•°æ®ç»“æ„ |

### 1.3 è®¾è®¡åŸåˆ™

1. **æ¨¡æ¿ = ç‰ˆå¼è¯†åˆ«**ï¼šé€šè¿‡è§†è§‰ç‰¹å¾ï¼ˆLogoã€ä½ç½®ã€æ ¼å¼ï¼‰åŒ¹é…æ¨¡æ¿
2. **Schema = æ•°æ®è§„èŒƒ**ï¼šæ¨¡æ¿ç»‘å®š Schemaï¼Œç¡®ä¿è¯†åˆ«ç»“æœç¬¦åˆæ•°æ®ç»“æ„
3. **ç‰ˆæœ¬åŒ–ç®¡ç†**ï¼šæ¨¡æ¿æ”¯æŒç‰ˆæœ¬åŒ–ï¼Œæ–°ç‰ˆæœ¬ä¸å½±å“å†å²æ•°æ®
4. **å¯è§†åŒ–é…ç½®**ï¼šæ”¯æŒå¯è§†åŒ–æ ‡æ³¨å…³é”®å­—æ®µä½ç½®

---

## ğŸ¨ äºŒã€é¡µé¢å¸ƒå±€è®¾è®¡

### 2.1 æ•´ä½“å¸ƒå±€ï¼ˆå·¦å³åˆ†æ ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•æ®æ¨¡æ¿é…ç½®                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚                                      â”‚
â”‚  å·¦ä¾§ï¼šæ¨¡æ¿åˆ—è¡¨  â”‚  å³ä¾§ï¼šæ¨¡æ¿è¯¦æƒ…/é¢„è§ˆ                  â”‚
â”‚                  â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æœç´¢æ¡†     â”‚  â”‚  â”‚  æ¨¡æ¿åŸºæœ¬ä¿¡æ¯                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ¨¡æ¿åˆ—è¡¨   â”‚  â”‚  â”‚  å‘ç¥¨é¢„è§ˆåŒºåŸŸ                  â”‚ â”‚
â”‚  â”‚            â”‚  â”‚  â”‚  [PDF/å›¾ç‰‡é¢„è§ˆ]                â”‚ â”‚
â”‚  â”‚ â€¢ æ¨¡æ¿1    â”‚  â”‚  â”‚                                â”‚ â”‚
â”‚  â”‚ â€¢ æ¨¡æ¿2    â”‚  â”‚  â”‚  [åŒ¹é…åŒºåŸŸé«˜äº®]                â”‚ â”‚
â”‚  â”‚ â€¢ æ¨¡æ¿3    â”‚  â”‚  â”‚                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                                      â”‚
â”‚  [+ æ–°å»ºæ¨¡æ¿]    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                  â”‚  â”‚  åŒ¹é…è§„åˆ™é…ç½®                  â”‚ â”‚
â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                                      â”‚
â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                  â”‚  â”‚  ç»‘å®š Schema                   â”‚ â”‚
â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å·¦ä¾§ï¼šæ¨¡æ¿åˆ—è¡¨

**åŠŸèƒ½ï¼š**
- æ¨¡æ¿æœç´¢ï¼ˆæŒ‰åç§°ã€ç±»å‹ï¼‰
- æ¨¡æ¿åˆ—è¡¨å±•ç¤º
- å¿«é€Ÿæ“ä½œï¼ˆç¼–è¾‘ã€åˆ é™¤ã€å¤åˆ¶ã€å¯ç”¨/åœç”¨ï¼‰

**åˆ—è¡¨å­—æ®µï¼š**
- æ¨¡æ¿åç§°
- å•æ®ç±»å‹ï¼ˆå¢å€¼ç¨å‘ç¥¨/æ™®é€šå‘ç¥¨/é‡‡è´­è®¢å•ç­‰ï¼‰
- ç»‘å®š Schemaï¼ˆæ˜¾ç¤º Schema åç§°å’Œç‰ˆæœ¬ï¼‰
- åŒ¹é…è§„åˆ™æ•°é‡
- çŠ¶æ€ï¼ˆå¯ç”¨/åœç”¨ï¼‰
- åˆ›å»ºæ—¶é—´
- æ“ä½œæŒ‰é’®

### 2.3 å³ä¾§ï¼šæ¨¡æ¿è¯¦æƒ…/ç¼–è¾‘

**ä¸‰ä¸ªä¸»è¦åŒºåŸŸï¼š**

#### åŒºåŸŸ1ï¼šæ¨¡æ¿åŸºæœ¬ä¿¡æ¯
- æ¨¡æ¿åç§°
- å•æ®ç±»å‹ï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼‰
- æè¿°
- ç¤ºä¾‹æ–‡ä»¶ï¼ˆPDF/å›¾ç‰‡ä¸Šä¼ ï¼‰
- çŠ¶æ€ï¼ˆå¯ç”¨/åœç”¨ï¼‰

#### åŒºåŸŸ2ï¼šå‘ç¥¨é¢„è§ˆä¸æ ‡æ³¨
- **PDF/å›¾ç‰‡é¢„è§ˆ**ï¼šæ˜¾ç¤ºç¤ºä¾‹å‘ç¥¨
- **åŒ¹é…åŒºåŸŸé«˜äº®**ï¼š
  - Logo åŒºåŸŸæ ‡æ³¨
  - å…³é”®å­—æ®µä½ç½®æ ‡æ³¨ï¼ˆå‘ç¥¨å·ç ã€æ—¥æœŸã€é‡‘é¢ç­‰ï¼‰
  - æ”¯æŒæ‹–æ‹½è°ƒæ•´æ ‡æ³¨åŒºåŸŸ
  - æ”¯æŒç¼©æ”¾ã€å¹³ç§»æŸ¥çœ‹

#### åŒºåŸŸ3ï¼šåŒ¹é…è§„åˆ™é…ç½®
- Logo åŒ¹é…è§„åˆ™
- å…³é”®å­—æ®µä½ç½®è§„åˆ™
- æ­£åˆ™ç‰¹å¾è§„åˆ™

---

## ğŸ”§ ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 3.1 æ¨¡æ¿åŸºæœ¬ä¿¡æ¯ç®¡ç†

#### 3.1.1 æ¨¡æ¿åç§°
- **å¿…å¡«é¡¹**
- **å”¯ä¸€æ€§æ ¡éªŒ**ï¼šåŒä¸€å•æ®ç±»å‹ä¸‹æ¨¡æ¿åç§°å”¯ä¸€
- **å‘½åè§„èŒƒ**ï¼šå»ºè®®ä½¿ç”¨"ä¾›åº”å•†åç§°_å‘ç¥¨ç±»å‹"æ ¼å¼

#### 3.1.2 å•æ®ç±»å‹
- **ä¸‹æ‹‰é€‰æ‹©**ï¼šå¢å€¼ç¨å‘ç¥¨ã€æ™®é€šå‘ç¥¨ã€é‡‡è´­è®¢å•ã€æ”¶æ®ã€å…¶ä»–
- **ç”¨é€”**ï¼šç”¨äºæ¨¡æ¿åˆ†ç±»å’Œå¿«é€Ÿç­›é€‰

#### 3.1.3 ç¤ºä¾‹æ–‡ä»¶
- **æ”¯æŒæ ¼å¼**ï¼šPDFã€JPGã€PNG
- **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š10MB
- **ç”¨é€”**ï¼š
  - ä½œä¸ºæ¨¡æ¿åŒ¹é…çš„å‚è€ƒ
  - ç”¨äºå¯è§†åŒ–æ ‡æ³¨
  - ç”¨äºæ¨¡æ¿é¢„è§ˆ

#### 3.1.4 çŠ¶æ€ç®¡ç†
- **å¯ç”¨**ï¼šæ¨¡æ¿å¯ç”¨äºè¯†åˆ«
- **åœç”¨**ï¼šæ¨¡æ¿ä¸å¯ç”¨äºè¯†åˆ«ï¼Œä½†ä¿ç•™å†å²æ•°æ®
- **åºŸå¼ƒ**ï¼šæ¨¡æ¿å·²ä¸å†ä½¿ç”¨

---

### 3.2 Schema ç»‘å®š

#### 3.2.1 Schema é€‰æ‹©
- **ä¸‹æ‹‰é€‰æ‹©**ï¼šä» Schema é…ç½®åˆ—è¡¨ä¸­é€‰æ‹©
- **æ˜¾ç¤ºä¿¡æ¯**ï¼š
  - Schema åç§°
  - Schema ç‰ˆæœ¬
  - å­—æ®µæ•°é‡
  - é€‚ç”¨å•æ®ç±»å‹

#### 3.2.2 ç»‘å®šå…³ç³»
- **ä¸€å¯¹ä¸€å…³ç³»**ï¼šä¸€ä¸ªæ¨¡æ¿ç»‘å®šä¸€ä¸ª Schema
- **ç‰ˆæœ¬ç®¡ç†**ï¼šç»‘å®š Schema çš„ç‰¹å®šç‰ˆæœ¬
- **éªŒè¯**ï¼šæ¨¡æ¿å­—æ®µåº”ä¸ Schema å­—æ®µåŒ¹é…

#### 3.2.3 Schema å­—æ®µæ˜ å°„
- **è‡ªåŠ¨æ˜ å°„**ï¼šæ ¹æ®å­—æ®µåç§°è‡ªåŠ¨åŒ¹é…
- **æ‰‹åŠ¨æ˜ å°„**ï¼šæ”¯æŒæ‰‹åŠ¨è°ƒæ•´å­—æ®µæ˜ å°„å…³ç³»
- **æ˜ å°„éªŒè¯**ï¼šç¡®ä¿æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½æœ‰æ˜ å°„

---

### 3.3 æ¨¡æ¿åŒ¹é…è§„åˆ™

#### 3.3.1 Logo åŒ¹é…è§„åˆ™

**å®šä½**ï¼šè¯†åˆ«å‘ç¥¨ä¸Šçš„ Logoï¼Œç”¨äºå¿«é€ŸåŒ¹é…æ¨¡æ¿

**é…ç½®é¡¹ï¼š**
- **Logo å›¾ç‰‡ä¸Šä¼ **ï¼šä¸Šä¼ æ ‡å‡† Logo å›¾ç‰‡
- **åŒ¹é…åŒºåŸŸ**ï¼šåœ¨é¢„è§ˆå›¾ä¸Šæ ‡æ³¨ Logo ä½ç½®ï¼ˆåæ ‡ï¼‰
- **ç›¸ä¼¼åº¦é˜ˆå€¼**ï¼š0-1ï¼Œé»˜è®¤ 0.8
- **åŒ¹é…ç®—æ³•**ï¼šå›¾åƒç›¸ä¼¼åº¦åŒ¹é…ï¼ˆSIFT/ORBï¼‰

**åŒ¹é…é€»è¾‘ï¼š**
```javascript
if (logoSimilarity >= threshold) {
  return "æ¨¡æ¿åŒ¹é…æˆåŠŸ"
}
```

#### 3.3.2 å…³é”®å­—æ®µä½ç½®è§„åˆ™

**å®šä½**ï¼šé€šè¿‡å…³é”®å­—æ®µçš„ä½ç½®ç‰¹å¾åŒ¹é…æ¨¡æ¿

**é…ç½®é¡¹ï¼š**
- **å­—æ®µé€‰æ‹©**ï¼šé€‰æ‹©å…³é”®å­—æ®µï¼ˆå¦‚ï¼šå‘ç¥¨å·ç ã€å¼€ç¥¨æ—¥æœŸã€é‡‘é¢ï¼‰
- **ä½ç½®æ ‡æ³¨**ï¼šåœ¨é¢„è§ˆå›¾ä¸Šæ ‡æ³¨å­—æ®µä½ç½®
  - æ”¯æŒçŸ©å½¢æ¡†æ ‡æ³¨
  - æ”¯æŒåæ ‡è®°å½•ï¼ˆx, y, width, heightï¼‰
- **æ ¼å¼ç‰¹å¾**ï¼šå­—æ®µçš„æ ¼å¼ç‰¹å¾ï¼ˆå¦‚ï¼šå‘ç¥¨å·ç çš„æ ¼å¼ï¼‰

**åŒ¹é…é€»è¾‘ï¼š**
```javascript
// æ£€æŸ¥å…³é”®å­—æ®µä½ç½®æ˜¯å¦åŒ¹é…
if (å…³é”®å­—æ®µä½ç½®åŒ¹é… && æ ¼å¼ç‰¹å¾åŒ¹é…) {
  return "æ¨¡æ¿åŒ¹é…æˆåŠŸ"
}
```

#### 3.3.3 æ­£åˆ™ç‰¹å¾è§„åˆ™

**å®šä½**ï¼šé€šè¿‡æ–‡æœ¬æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ¨¡æ¿

**é…ç½®é¡¹ï¼š**
- **è§„åˆ™åç§°**ï¼šè§„åˆ™æè¿°
- **æ­£åˆ™è¡¨è¾¾å¼**ï¼šåŒ¹é…è§„åˆ™ï¼ˆå¦‚ï¼š`å‘ç¥¨å·ç ï¼š\d{8,12}`ï¼‰
- **åŒ¹é…åŒºåŸŸ**ï¼šåœ¨é¢„è§ˆå›¾ä¸Šæ ‡æ³¨åŒ¹é…åŒºåŸŸ
- **ä¼˜å…ˆçº§**ï¼šè§„åˆ™ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰

**åŒ¹é…é€»è¾‘ï¼š**
```javascript
// æŒ‰ä¼˜å…ˆçº§é¡ºåºåŒ¹é…
for (rule of rules.sortByPriority()) {
  if (regex.test(ocrText)) {
    return "æ¨¡æ¿åŒ¹é…æˆåŠŸ"
  }
}
```

#### 3.3.4 ç»„åˆåŒ¹é…ç­–ç•¥

**ç­–ç•¥ç±»å‹ï¼š**
1. **å…¨éƒ¨åŒ¹é…**ï¼šæ‰€æœ‰è§„åˆ™éƒ½åŒ¹é…æ‰æˆåŠŸ
2. **ä»»ä¸€åŒ¹é…**ï¼šä»»ä¸€è§„åˆ™åŒ¹é…å³æˆåŠŸ
3. **åŠ æƒåŒ¹é…**ï¼šæ ¹æ®è§„åˆ™æƒé‡è®¡ç®—åŒ¹é…åº¦

**åŒ¹é…åº¦è®¡ç®—ï¼š**
```javascript
matchScore = (
  logoMatch * logoWeight +
  positionMatch * positionWeight +
  regexMatch * regexWeight
) / totalWeight

if (matchScore >= threshold) {
  return "æ¨¡æ¿åŒ¹é…æˆåŠŸ"
}
```

---

## ğŸ“Š å››ã€æ•°æ®ç»“æ„è®¾è®¡

### 4.1 Templateï¼ˆæ¨¡æ¿è¡¨ï¼‰

```typescript
interface Template {
  id: string                    // æ¨¡æ¿ID
  name: string                  // æ¨¡æ¿åç§°
  template_type: string         // å•æ®ç±»å‹
  description?: string           // æè¿°
  status: string                // çŠ¶æ€ï¼šenabled/disabled/deprecated
  
  // Schema ç»‘å®š
  schema_id?: string            // ç»‘å®šçš„ Schema ID
  schema_version?: string        // Schema ç‰ˆæœ¬
  
  // ç¤ºä¾‹æ–‡ä»¶
  sample_file_path?: string     // ç¤ºä¾‹æ–‡ä»¶è·¯å¾„
  sample_file_type?: string     // æ–‡ä»¶ç±»å‹ï¼špdf/jpg/png
  
  // åŒ¹é…è§„åˆ™
  matching_rules?: {
    logo?: {
      image_path: string
      position: { x: number, y: number, width: number, height: number }
      similarity_threshold: number
    }
    key_fields?: Array<{
      field_name: string
      position: { x: number, y: number, width: number, height: number }
      format_pattern?: string
    }>
    regex_rules?: Array<{
      name: string
      pattern: string
      position?: { x: number, y: number, width: number, height: number }
      priority: number
    }>
    matching_strategy: 'all' | 'any' | 'weighted'
    match_threshold: number
  }
  
  // ç»Ÿè®¡ä¿¡æ¯
  match_count?: number          // åŒ¹é…æ¬¡æ•°
  accuracy?: number              // è¯†åˆ«å‡†ç¡®ç‡
  
  // å…ƒæ•°æ®
  creator_id: string
  create_time: string
  update_time?: string
}
```

### 4.2 TemplateVersionï¼ˆæ¨¡æ¿ç‰ˆæœ¬è¡¨ï¼‰

```typescript
interface TemplateVersion {
  id: string
  template_id: string
  version: string                // ç‰ˆæœ¬å·ï¼šv1.0.0
  status: string                // draft/published/deprecated
  
  // Schema å¿«ç…§
  schema_snapshot?: any          // Schema å¿«ç…§ï¼ˆå‘å¸ƒæ—¶ç”Ÿæˆï¼‰
  
  // åŒ¹é…è§„åˆ™å¿«ç…§
  matching_rules_snapshot?: any  // åŒ¹é…è§„åˆ™å¿«ç…§
  
  created_by: string
  created_at: string
  published_at?: string
}
```

---

## ğŸ¯ äº”ã€äº¤äº’æµç¨‹è®¾è®¡

### 5.1 åˆ›å»ºæ¨¡æ¿æµç¨‹

```
1. ç‚¹å‡»"æ–°å»ºæ¨¡æ¿"
   â†“
2. å¡«å†™åŸºæœ¬ä¿¡æ¯
   - æ¨¡æ¿åç§°
   - å•æ®ç±»å‹
   - æè¿°
   â†“
3. ä¸Šä¼ ç¤ºä¾‹æ–‡ä»¶
   - ä¸Šä¼  PDF/å›¾ç‰‡
   - é¢„è§ˆæ˜¾ç¤º
   â†“
4. ç»‘å®š Schema
   - é€‰æ‹© Schema
   - éªŒè¯å­—æ®µæ˜ å°„
   â†“
5. é…ç½®åŒ¹é…è§„åˆ™
   - Logo æ ‡æ³¨
   - å…³é”®å­—æ®µä½ç½®æ ‡æ³¨
   - æ­£åˆ™è§„åˆ™é…ç½®
   â†“
6. ä¿å­˜æ¨¡æ¿
   - éªŒè¯å¿…å¡«é¡¹
   - ä¿å­˜åˆ°æ•°æ®åº“
```

### 5.2 ç¼–è¾‘æ¨¡æ¿æµç¨‹

```
1. ä»åˆ—è¡¨é€‰æ‹©æ¨¡æ¿
   â†“
2. åŠ è½½æ¨¡æ¿è¯¦æƒ…
   - åŸºæœ¬ä¿¡æ¯
   - ç¤ºä¾‹æ–‡ä»¶é¢„è§ˆ
   - åŒ¹é…è§„åˆ™
   â†“
3. ä¿®æ”¹é…ç½®
   - å¯ä¿®æ”¹æ‰€æœ‰å­—æ®µ
   - å®æ—¶é¢„è§ˆæ•ˆæœ
   â†“
4. ä¿å­˜æ›´æ”¹
   - åˆ›å»ºæ–°ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰
   - æˆ–æ›´æ–°å½“å‰ç‰ˆæœ¬
```

### 5.3 æ¨¡æ¿åŒ¹é…æµç¨‹ï¼ˆè¯†åˆ«æ—¶ï¼‰

```
1. ä¸Šä¼ å‘ç¥¨æ–‡ä»¶
   â†“
2. æå–ç‰¹å¾
   - OCR è¯†åˆ«æ–‡æœ¬
   - æå– Logo
   - æå–å­—æ®µä½ç½®
   â†“
3. æ¨¡æ¿åŒ¹é…
   - æŒ‰ä¼˜å…ˆçº§éå†æ¨¡æ¿
   - æ‰§è¡ŒåŒ¹é…è§„åˆ™
   - è®¡ç®—åŒ¹é…åº¦
   â†“
4. é€‰æ‹©æœ€ä½³æ¨¡æ¿
   - åŒ¹é…åº¦æœ€é«˜çš„æ¨¡æ¿
   - æˆ–åŒ¹é…åº¦ > é˜ˆå€¼çš„æ¨¡æ¿
   â†“
5. ä½¿ç”¨æ¨¡æ¿è¯†åˆ«
   - ä½¿ç”¨æ¨¡æ¿ç»‘å®šçš„ Schema
   - æ‰§è¡Œè¯†åˆ«ä»»åŠ¡
```

---

## ğŸ’¡ å…­ã€äº§å“æ„Ÿå»ºè®®

### 6.1 å¯è§†åŒ–æ ‡æ³¨

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **æ‹–æ‹½æ ‡æ³¨**ï¼šæ”¯æŒåœ¨é¢„è§ˆå›¾ä¸Šæ‹–æ‹½åˆ›å»ºæ ‡æ³¨æ¡†
- **æ ‡æ³¨ç¼–è¾‘**ï¼šæ”¯æŒè°ƒæ•´æ ‡æ³¨æ¡†å¤§å°å’Œä½ç½®
- **æ ‡æ³¨åˆ—è¡¨**ï¼šæ˜¾ç¤ºæ‰€æœ‰æ ‡æ³¨ï¼Œæ”¯æŒå¿«é€Ÿå®šä½
- **æ ‡æ³¨å¯¼å‡º**ï¼šå¯¼å‡ºæ ‡æ³¨æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰

**æŠ€æœ¯å®ç°ï¼š**
- ä½¿ç”¨ Canvas æˆ– SVG å®ç°æ ‡æ³¨åŠŸèƒ½
- æ”¯æŒç¼©æ”¾ã€å¹³ç§»æŸ¥çœ‹å¤§å›¾
- æ ‡æ³¨æ•°æ®å­˜å‚¨ä¸ºåæ ‡ä¿¡æ¯

### 6.2 æ¨¡æ¿é¢„è§ˆ

**åŠŸèƒ½ï¼š**
- **PDF é¢„è§ˆ**ï¼šä½¿ç”¨ PDF.js æˆ–ç±»ä¼¼åº“
- **å›¾ç‰‡é¢„è§ˆ**ï¼šæ”¯æŒ JPG/PNG
- **æ ‡æ³¨å åŠ **ï¼šåœ¨é¢„è§ˆå›¾ä¸Šå åŠ æ ‡æ³¨æ¡†
- **é«˜äº®æ˜¾ç¤º**ï¼šåŒ¹é…åŒºåŸŸé«˜äº®æ˜¾ç¤º

### 6.3 åŒ¹é…è§„åˆ™æµ‹è¯•

**åŠŸèƒ½ï¼š**
- **æµ‹è¯•åŒ¹é…**ï¼šä¸Šä¼ æµ‹è¯•æ–‡ä»¶ï¼Œæµ‹è¯•åŒ¹é…è§„åˆ™
- **åŒ¹é…ç»“æœ**ï¼šæ˜¾ç¤ºåŒ¹é…åº¦ã€åŒ¹é…çš„è§„åˆ™
- **å¯è§†åŒ–åé¦ˆ**ï¼šåœ¨é¢„è§ˆå›¾ä¸Šé«˜äº®åŒ¹é…åŒºåŸŸ

### 6.4 ç‰ˆæœ¬ç®¡ç†

**åŠŸèƒ½ï¼š**
- **ç‰ˆæœ¬å†å²**ï¼šæŸ¥çœ‹æ¨¡æ¿ç‰ˆæœ¬å†å²
- **ç‰ˆæœ¬å¯¹æ¯”**ï¼šå¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„å·®å¼‚
- **ç‰ˆæœ¬å›æ»š**ï¼šå›æ»šåˆ°å†å²ç‰ˆæœ¬
- **ç‰ˆæœ¬å‘å¸ƒ**ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œä¸å½±å“å†å²æ•°æ®

---

## ğŸ”— ä¸ƒã€ä¸å…¶ä»–æ¨¡å—çš„å…³ç³»

### 7.1 ä¸ Schema çš„å…³ç³»

```
Template â”€â”€ç»‘å®šâ”€â”€> Schema
   â”‚                  â”‚
   â”‚                  â”‚
   â”‚                  â””â”€â”€> å®šä¹‰æ•°æ®ç»“æ„
   â”‚
   â””â”€â”€> å®šä¹‰ç‰ˆå¼/æ ·å¼
```

**å…³ç³»è¯´æ˜ï¼š**
- Template ç»‘å®š Schemaï¼Œç¡®ä¿è¯†åˆ«ç»“æœç¬¦åˆæ•°æ®ç»“æ„
- Schema å˜æ›´ä¸å½±å“å·²å‘å¸ƒçš„ Template ç‰ˆæœ¬ï¼ˆä½¿ç”¨å¿«ç…§ï¼‰
- Template å¯ä»¥åˆ‡æ¢ç»‘å®šçš„ Schemaï¼ˆåˆ›å»ºæ–°ç‰ˆæœ¬ï¼‰

### 7.2 ä¸è¯†åˆ«ä»»åŠ¡çš„å…³ç³»

```
ä¸Šä¼ å‘ç¥¨ â”€â”€åŒ¹é…â”€â”€> Template â”€â”€ä½¿ç”¨â”€â”€> Schema â”€â”€è¯†åˆ«â”€â”€> ç»“æœ
```

**æµç¨‹è¯´æ˜ï¼š**
1. ä¸Šä¼ å‘ç¥¨æ–‡ä»¶
2. ä½¿ç”¨åŒ¹é…è§„åˆ™åŒ¹é… Template
3. ä½¿ç”¨ Template ç»‘å®šçš„ Schema è¿›è¡Œè¯†åˆ«
4. è¿”å›è¯†åˆ«ç»“æœ

### 7.3 ä¸è¯†åˆ«è§„åˆ™çš„å…³ç³»

```
Template â”€â”€åº”ç”¨â”€â”€> RecognitionRule
```

**å…³ç³»è¯´æ˜ï¼š**
- Template å¯ä»¥åº”ç”¨è¯†åˆ«è§„åˆ™
- è¯†åˆ«è§„åˆ™å¯ä»¥é’ˆå¯¹ç‰¹å®š Template æˆ–å…¨å±€
- è§„åˆ™ä¼˜å…ˆçº§ï¼šTemplate è§„åˆ™ > å…¨å±€è§„åˆ™

---

## ğŸ“ å…«ã€API è®¾è®¡å»ºè®®

### 8.1 æ¨¡æ¿ç®¡ç† API

```typescript
// è·å–æ¨¡æ¿åˆ—è¡¨
GET /api/v1/templates
Query: {
  name?: string
  template_type?: string
  status?: string
  schema_id?: string
  page?: number
  page_size?: number
}

// è·å–æ¨¡æ¿è¯¦æƒ…
GET /api/v1/templates/{id}

// åˆ›å»ºæ¨¡æ¿
POST /api/v1/templates
Body: {
  name: string
  template_type: string
  description?: string
  schema_id?: string
  sample_file?: File
  matching_rules?: MatchingRules
}

// æ›´æ–°æ¨¡æ¿
PUT /api/v1/templates/{id}
Body: { ... }

// åˆ é™¤æ¨¡æ¿
DELETE /api/v1/templates/{id}

// æµ‹è¯•æ¨¡æ¿åŒ¹é…
POST /api/v1/templates/{id}/test-match
Body: {
  file: File
}
Response: {
  matched: boolean
  match_score: number
  matched_rules: string[]
}
```

### 8.2 åŒ¹é…è§„åˆ™ API

```typescript
// æ›´æ–°åŒ¹é…è§„åˆ™
PUT /api/v1/templates/{id}/matching-rules
Body: {
  logo?: LogoRule
  key_fields?: KeyFieldRule[]
  regex_rules?: RegexRule[]
  matching_strategy: string
  match_threshold: number
}

// æ ‡æ³¨æ•°æ®ç®¡ç†
POST /api/v1/templates/{id}/annotations
Body: {
  type: 'logo' | 'field' | 'regex'
  position: { x, y, width, height }
  data: any
}
```

---

## ğŸ¨ ä¹ã€UI/UX è®¾è®¡å»ºè®®

### 9.1 é¢œè‰²æ–¹æ¡ˆ

- **æ¨¡æ¿åˆ—è¡¨**ï¼šæµ…ç°è‰²èƒŒæ™¯ï¼Œç™½è‰²å¡ç‰‡
- **é€‰ä¸­æ¨¡æ¿**ï¼šè“è‰²è¾¹æ¡†é«˜äº®
- **æ ‡æ³¨æ¡†**ï¼šä¸åŒé¢œè‰²åŒºåˆ†ä¸åŒç±»å‹ï¼ˆLogo=çº¢è‰²ï¼Œå­—æ®µ=è“è‰²ï¼Œæ­£åˆ™=ç»¿è‰²ï¼‰
- **åŒ¹é…åŒºåŸŸ**ï¼šåŠé€æ˜ç»¿è‰²é«˜äº®

### 9.2 äº¤äº’ç»†èŠ‚

- **æ‹–æ‹½æ ‡æ³¨**ï¼šé¼ æ ‡æŒ‰ä¸‹åˆ›å»ºæ ‡æ³¨æ¡†ï¼Œæ‹–æ‹½è°ƒæ•´å¤§å°
- **åŒå‡»ç¼–è¾‘**ï¼šåŒå‡»æ ‡æ³¨æ¡†ç¼–è¾‘è§„åˆ™
- **å³é”®èœå•**ï¼šå³é”®æ ‡æ³¨æ¡†æ˜¾ç¤ºæ“ä½œèœå•ï¼ˆç¼–è¾‘/åˆ é™¤ï¼‰
- **å¿«æ·é”®**ï¼šæ”¯æŒé”®ç›˜å¿«æ·é”®æ“ä½œ

### 9.3 å“åº”å¼è®¾è®¡

- **æ¡Œé¢ç«¯**ï¼šå·¦å³åˆ†æ å¸ƒå±€
- **å¹³æ¿ç«¯**ï¼šä¸Šä¸‹å¸ƒå±€ï¼Œåˆ—è¡¨åœ¨ä¸Šï¼Œè¯¦æƒ…åœ¨ä¸‹
- **ç§»åŠ¨ç«¯**ï¼šå…¨å±åˆ‡æ¢ï¼Œåˆ—è¡¨å’Œè¯¦æƒ…åˆ†åˆ«å…¨å±æ˜¾ç¤º

---

## âœ… åã€å®æ–½ä¼˜å…ˆçº§

### Phase 1ï¼šåŸºç¡€åŠŸèƒ½ï¼ˆMVPï¼‰
1. âœ… æ¨¡æ¿åŸºæœ¬ä¿¡æ¯ç®¡ç†
2. âœ… Schema ç»‘å®š
3. âœ… æ¨¡æ¿åˆ—è¡¨å’Œè¯¦æƒ…
4. âœ… ç¤ºä¾‹æ–‡ä»¶ä¸Šä¼ å’Œé¢„è§ˆ

### Phase 2ï¼šåŒ¹é…è§„åˆ™ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. âœ… Logo åŒ¹é…è§„åˆ™
2. âœ… å…³é”®å­—æ®µä½ç½®è§„åˆ™
3. âœ… æ­£åˆ™ç‰¹å¾è§„åˆ™
4. âœ… åŒ¹é…è§„åˆ™æµ‹è¯•

### Phase 3ï¼šå¯è§†åŒ–æ ‡æ³¨ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰
1. âœ… å¯è§†åŒ–æ ‡æ³¨å·¥å…·
2. âœ… æ ‡æ³¨æ•°æ®ç®¡ç†
3. âœ… æ ‡æ³¨å¯¼å‡º/å¯¼å…¥

### Phase 4ï¼šé«˜çº§åŠŸèƒ½ï¼ˆä¼˜åŒ–ï¼‰
1. âœ… ç‰ˆæœ¬ç®¡ç†
2. âœ… åŒ¹é…è§„åˆ™ä¼˜åŒ–
3. âœ… æ¨¡æ¿æ€§èƒ½ç›‘æ§
4. âœ… æ‰¹é‡æ“ä½œ

---

## ğŸ“š åä¸€ã€å‚è€ƒèµ„æ–™

- [Template API æ–‡æ¡£](../backend/TEMPLATE_API_DOCUMENTATION.md)
- [æ•°æ®åº“ Schema è®¾è®¡](../backend/DATABASE_SCHEMA.md)
- [Schema é…ç½®è®¾è®¡](./SCHEMA_CONFIG_DESIGN.md)

---

**è®¾è®¡æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2024-12-19  
**è®¾è®¡è€…**ï¼šAI Assistant

