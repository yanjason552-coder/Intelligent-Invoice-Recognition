# å‘ç¥¨é¢„è§ˆä¸æ ‡æ³¨é¡µé¢è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ä¸€ã€åŠŸèƒ½éœ€æ±‚åˆ†æ

### 1.1 æ ¸å¿ƒåŠŸèƒ½
- âœ… å‘ç¥¨å›¾ç‰‡/PDFé¢„è§ˆ
- âœ… å­—æ®µä½ç½®æ ‡æ³¨ï¼ˆçŸ©å½¢æ¡†ï¼‰
- âœ… Logoä½ç½®æ ‡æ³¨
- âœ… æ­£åˆ™åŒ¹é…åŒºåŸŸæ ‡æ³¨
- âœ… æ ‡æ³¨ä¸æ¨¡æ¿å­—æ®µå…³è”
- âœ… æ ‡æ³¨ç¼–è¾‘ã€åˆ é™¤ã€é‡å‘½å
- âœ… æ ‡æ³¨åˆ—è¡¨ç®¡ç†
- âœ… åæ ‡ç³»ç»Ÿï¼ˆæ”¯æŒç¼©æ”¾ï¼‰

### 1.2 ç”¨æˆ·ä½“éªŒéœ€æ±‚
- ç›´è§‚çš„å¯è§†åŒ–æ ‡æ³¨ç•Œé¢
- æµç•…çš„äº¤äº’æ“ä½œ
- æ¸…æ™°çš„æ ‡æ³¨ä¿¡æ¯å±•ç¤º
- ä¾¿æ·çš„å­—æ®µå…³è”æ“ä½œ

---

## ğŸ¨ äºŒã€UIå¸ƒå±€è®¾è®¡

### 2.1 æ•´ä½“å¸ƒå±€ï¼ˆä¸‰æ å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡æ¿ç¼–è¾‘é¡µé¢                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                          â”‚                   â”‚
â”‚  å·¦ä¾§ï¼š      â”‚  ä¸­é—´ï¼š                  â”‚  å³ä¾§ï¼š           â”‚
â”‚  æ¨¡æ¿é…ç½®    â”‚  å‘ç¥¨é¢„è§ˆä¸æ ‡æ³¨          â”‚  æ ‡æ³¨åˆ—è¡¨ä¸å­—æ®µ  â”‚
â”‚              â”‚                          â”‚                   â”‚
â”‚  - åŸºæœ¬ä¿¡æ¯  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  - Schema    â”‚  â”‚                    â”‚  â”‚  â”‚ æ ‡æ³¨åˆ—è¡¨     â”‚ â”‚
â”‚  - å­—æ®µå®šä¹‰  â”‚  â”‚   å‘ç¥¨é¢„è§ˆå›¾        â”‚  â”‚  â”‚ - Logo      â”‚ â”‚
â”‚              â”‚  â”‚   (Canvas/Image)   â”‚  â”‚  â”‚ - å­—æ®µ1     â”‚ â”‚
â”‚              â”‚  â”‚                    â”‚  â”‚  â”‚ - å­—æ®µ2     â”‚ â”‚
â”‚              â”‚  â”‚   [æ ‡æ³¨æ¡†æ˜¾ç¤º]     â”‚  â”‚  â”‚              â”‚ â”‚
â”‚              â”‚  â”‚                    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚              â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚              â”‚  [å·¥å…·æ ]                â”‚  â”‚ å­—æ®µå…³è”     â”‚ â”‚
â”‚              â”‚  - é€‰æ‹©å·¥å…·              â”‚  â”‚ - å­—æ®µåç§°   â”‚ â”‚
â”‚              â”‚  - æ ‡æ³¨å·¥å…·              â”‚  â”‚ - å­—æ®µç±»å‹   â”‚ â”‚
â”‚              â”‚  - åˆ é™¤å·¥å…·              â”‚  â”‚              â”‚ â”‚
â”‚              â”‚  - ç¼©æ”¾æ§åˆ¶              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                          â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å“åº”å¼å¸ƒå±€
- **å¤§å±ï¼ˆ>1200pxï¼‰**ï¼šä¸‰æ å¸ƒå±€
- **ä¸­å±ï¼ˆ768-1200pxï¼‰**ï¼šä¸¤æ å¸ƒå±€ï¼ˆå·¦ä¾§+ä¸­é—´ï¼Œå³ä¾§å¯æŠ˜å ï¼‰
- **å°å±ï¼ˆ<768pxï¼‰**ï¼šå•æ å¸ƒå±€ï¼ˆæ ‡ç­¾é¡µåˆ‡æ¢ï¼‰

---

## ğŸ› ï¸ ä¸‰ã€åŠŸèƒ½æ¨¡å—è®¾è®¡

### 3.1 é¢„è§ˆåŒºåŸŸ

#### 3.1.1 å›¾ç‰‡é¢„è§ˆ
- **æ”¯æŒæ ¼å¼**ï¼šJPGã€PNGã€PDFï¼ˆPDFéœ€è½¬æ¢ä¸ºå›¾ç‰‡ï¼‰
- **æ˜¾ç¤ºæ–¹å¼**ï¼š
  - Canvasæ¸²æŸ“ï¼ˆæ”¯æŒæ ‡æ³¨ç»˜åˆ¶ï¼‰
  - æˆ– SVGè¦†ç›–å±‚ï¼ˆæ›´çµæ´»ï¼‰
- **ç¼©æ”¾åŠŸèƒ½**ï¼š
  - é¼ æ ‡æ»šè½®ç¼©æ”¾
  - ç¼©æ”¾æ»‘å—ï¼ˆ0.5x - 2xï¼‰
  - é€‚åº”çª—å£æŒ‰é’®
- **å¹³ç§»åŠŸèƒ½**ï¼š
  - æ‹–æ‹½ç§»åŠ¨ï¼ˆå½“å›¾ç‰‡å¤§äºå®¹å™¨æ—¶ï¼‰
  - é‡ç½®ä½ç½®æŒ‰é’®

#### 3.1.2 PDFé¢„è§ˆ
- **æ–¹æ¡ˆ1**ï¼šPDF.jsè½¬æ¢ä¸ºCanvas
- **æ–¹æ¡ˆ2**ï¼šåç«¯APIè½¬æ¢ä¸ºå›¾ç‰‡
- **æ–¹æ¡ˆ3**ï¼šiframeåµŒå…¥ï¼ˆæ ‡æ³¨åŠŸèƒ½å—é™ï¼‰

**æ¨èæ–¹æ¡ˆ**ï¼šåç«¯è½¬æ¢ä¸ºå›¾ç‰‡ï¼Œå‰ç«¯ä½¿ç”¨Canvasæ ‡æ³¨

### 3.2 æ ‡æ³¨å·¥å…·

#### 3.2.1 æ ‡æ³¨ç±»å‹
1. **å­—æ®µæ ‡æ³¨ï¼ˆFieldï¼‰**
   - é¢œè‰²ï¼šè“è‰² (#3B82F6)
   - ç”¨é€”ï¼šæ ‡æ³¨å­—æ®µä½ç½®
   - å…³è”ï¼šå¿…é¡»å…³è”åˆ°æ¨¡æ¿å­—æ®µ

2. **Logoæ ‡æ³¨ï¼ˆLogoï¼‰**
   - é¢œè‰²ï¼šç»¿è‰² (#10B981)
   - ç”¨é€”ï¼šæ ‡æ³¨Logoä½ç½®
   - å…³è”ï¼šå…³è”åˆ°LogoåŒ¹é…è§„åˆ™

3. **æ­£åˆ™åŒºåŸŸæ ‡æ³¨ï¼ˆRegexï¼‰**
   - é¢œè‰²ï¼šæ©™è‰² (#F59E0B)
   - ç”¨é€”ï¼šæ ‡æ³¨æ­£åˆ™åŒ¹é…åŒºåŸŸ
   - å…³è”ï¼šå…³è”åˆ°æ­£åˆ™è§„åˆ™

#### 3.2.2 æ ‡æ³¨æ“ä½œ
- **åˆ›å»ºæ ‡æ³¨**ï¼š
  - ç‚¹å‡»"æ ‡æ³¨"æŒ‰é’®è¿›å…¥æ ‡æ³¨æ¨¡å¼
  - åœ¨å›¾ç‰‡ä¸Šæ‹–æ‹½åˆ›å»ºçŸ©å½¢æ¡†
  - åˆ›å»ºåå¼¹å‡ºæ ‡æ³¨å±æ€§å¯¹è¯æ¡†

- **ç¼–è¾‘æ ‡æ³¨**ï¼š
  - ç‚¹å‡»æ ‡æ³¨æ¡†é€‰ä¸­
  - æ˜¾ç¤ºæ§åˆ¶ç‚¹ï¼ˆ8ä¸ªç‚¹ï¼š4è§’+4è¾¹ä¸­ç‚¹ï¼‰
  - æ‹–æ‹½æ§åˆ¶ç‚¹è°ƒæ•´å¤§å°
  - æ‹–æ‹½æ ‡æ³¨æ¡†ç§»åŠ¨ä½ç½®

- **åˆ é™¤æ ‡æ³¨**ï¼š
  - é€‰ä¸­æ ‡æ³¨åæŒ‰Deleteé”®
  - æˆ–ç‚¹å‡»åˆ é™¤æŒ‰é’®
  - ç¡®è®¤å¯¹è¯æ¡†

- **æ ‡æ³¨å±æ€§**ï¼š
  - æ ‡æ³¨ç±»å‹é€‰æ‹©
  - æ ‡æ³¨åç§°/æ ‡ç­¾
  - å…³è”å­—æ®µé€‰æ‹©
  - åæ ‡ä¿¡æ¯æ˜¾ç¤ºï¼ˆx, y, width, heightï¼‰

### 3.3 æ ‡æ³¨åˆ—è¡¨é¢æ¿

#### 3.3.1 åˆ—è¡¨æ˜¾ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ‡æ³¨åˆ—è¡¨ (3)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ Logo - å…¬å¸Logo          â”‚
â”‚   ä½ç½®: (50, 30, 100, 50)   â”‚
â”‚   [ç¼–è¾‘] [åˆ é™¤]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ å­—æ®µ - å‘ç¥¨å·ç            â”‚
â”‚   ä½ç½®: (200, 100, 150, 30) â”‚
â”‚   å…³è”: invoice_no          â”‚
â”‚   [ç¼–è¾‘] [åˆ é™¤]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ  æ­£åˆ™ - é‡‘é¢åŒ¹é…          â”‚
â”‚   ä½ç½®: (300, 200, 200, 30) â”‚
â”‚   è§„åˆ™: \d+\.\d{2}          â”‚
â”‚   [ç¼–è¾‘] [åˆ é™¤]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3.2 äº¤äº’åŠŸèƒ½
- **ç‚¹å‡»åˆ—è¡¨é¡¹**ï¼šé«˜äº®å¯¹åº”æ ‡æ³¨æ¡†
- **æ‚¬åœåˆ—è¡¨é¡¹**ï¼šé¢„è§ˆæ ‡æ³¨ä½ç½®
- **æ‹–æ‹½æ’åº**ï¼šè°ƒæ•´æ ‡æ³¨ä¼˜å…ˆçº§
- **æ‰¹é‡æ“ä½œ**ï¼šå…¨é€‰ã€æ‰¹é‡åˆ é™¤

### 3.4 å­—æ®µå…³è”é¢æ¿

#### 3.4.1 å­—æ®µé€‰æ‹©
- **ä¸‹æ‹‰é€‰æ‹©**ï¼šä»æ¨¡æ¿å­—æ®µåˆ—è¡¨é€‰æ‹©
- **è‡ªåŠ¨åŒ¹é…**ï¼šæ ¹æ®æ ‡æ³¨åç§°è‡ªåŠ¨åŒ¹é…å­—æ®µ
- **å­—æ®µä¿¡æ¯**ï¼šæ˜¾ç¤ºå­—æ®µç±»å‹ã€æ˜¯å¦å¿…å¡«ç­‰

#### 3.4.2 å…³è”çŠ¶æ€
- **å·²å…³è”**ï¼šæ˜¾ç¤ºç»¿è‰²æ ‡è®°
- **æœªå…³è”**ï¼šæ˜¾ç¤ºé»„è‰²è­¦å‘Š
- **å…³è”å†²çª**ï¼šå¤šä¸ªæ ‡æ³¨å…³è”åŒä¸€å­—æ®µæ—¶è­¦å‘Š

---

## ğŸ’» å››ã€æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 4.1 ç»„ä»¶æ¶æ„

```
InvoiceAnnotationEditor (ä¸»ç»„ä»¶)
â”œâ”€â”€ AnnotationToolbar (å·¥å…·æ )
â”‚   â”œâ”€â”€ ToolSelector (å·¥å…·é€‰æ‹©)
â”‚   â”œâ”€â”€ ZoomControls (ç¼©æ”¾æ§åˆ¶)
â”‚   â””â”€â”€ ActionButtons (æ“ä½œæŒ‰é’®)
â”œâ”€â”€ AnnotationCanvas (æ ‡æ³¨ç”»å¸ƒ)
â”‚   â”œâ”€â”€ ImageRenderer (å›¾ç‰‡æ¸²æŸ“)
â”‚   â”œâ”€â”€ AnnotationLayer (æ ‡æ³¨å±‚)
â”‚   â””â”€â”€ InteractionHandler (äº¤äº’å¤„ç†)
â”œâ”€â”€ AnnotationList (æ ‡æ³¨åˆ—è¡¨)
â”‚   â”œâ”€â”€ AnnotationItem (æ ‡æ³¨é¡¹)
â”‚   â””â”€â”€ AnnotationFilter (ç­›é€‰å™¨)
â””â”€â”€ FieldAssociationPanel (å­—æ®µå…³è”é¢æ¿)
    â”œâ”€â”€ FieldSelector (å­—æ®µé€‰æ‹©å™¨)
    â””â”€â”€ AssociationStatus (å…³è”çŠ¶æ€)
```

### 4.2 åæ ‡ç³»ç»Ÿ

#### 4.2.1 åæ ‡è½¬æ¢
```typescript
// å±å¹•åæ ‡ -> å›¾ç‰‡åæ ‡
function screenToImage(screenX: number, screenY: number, scale: number, offset: {x: number, y: number}) {
  return {
    x: (screenX - offset.x) / scale,
    y: (screenY - offset.y) / scale
  }
}

// å›¾ç‰‡åæ ‡ -> å±å¹•åæ ‡
function imageToScreen(imageX: number, imageY: number, scale: number, offset: {x: number, y: number}) {
  return {
    x: imageX * scale + offset.x,
    y: imageY * scale + offset.y
  }
}
```

#### 4.2.2 åæ ‡å­˜å‚¨
- **å­˜å‚¨æ ¼å¼**ï¼šç›¸å¯¹äºåŸå§‹å›¾ç‰‡çš„åæ ‡ï¼ˆä¸å—ç¼©æ”¾å½±å“ï¼‰
- **å•ä½**ï¼šåƒç´ ï¼ˆpxï¼‰
- **ç²¾åº¦**ï¼šæ•´æ•°æˆ–ä¿ç•™1ä½å°æ•°

### 4.3 æ ‡æ³¨æ•°æ®ç»“æ„

```typescript
interface Annotation {
  id: string
  type: 'field' | 'logo' | 'regex'
  label: string  // æ ‡æ³¨åç§°
  x: number      // å·¦ä¸Šè§’Xåæ ‡ï¼ˆå›¾ç‰‡åæ ‡ï¼‰
  y: number      // å·¦ä¸Šè§’Yåæ ‡ï¼ˆå›¾ç‰‡åæ ‡ï¼‰
  width: number  // å®½åº¦ï¼ˆå›¾ç‰‡åæ ‡ï¼‰
  height: number // é«˜åº¦ï¼ˆå›¾ç‰‡åæ ‡ï¼‰
  color: string  // æ ‡æ³¨é¢œè‰²
  fieldId?: string  // å…³è”çš„å­—æ®µID
  fieldName?: string // å…³è”çš„å­—æ®µåç§°
  regexPattern?: string // æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä»…regexç±»å‹ï¼‰
  priority?: number    // ä¼˜å…ˆçº§ï¼ˆä»…regexç±»å‹ï¼‰
  createdAt: string
  updatedAt: string
}
```

### 4.4 çŠ¶æ€ç®¡ç†

```typescript
interface AnnotationState {
  // å›¾ç‰‡ç›¸å…³
  imageUrl: string | null
  imageSize: { width: number, height: number } | null
  scale: number
  offset: { x: number, y: number }
  
  // æ ‡æ³¨ç›¸å…³
  annotations: Annotation[]
  selectedAnnotationId: string | null
  currentTool: 'select' | 'annotate' | 'delete'
  isDrawing: boolean
  
  // UIçŠ¶æ€
  showAnnotationList: boolean
  showFieldPanel: boolean
  annotationDialogOpen: boolean
}
```

---

## ğŸ¯ äº”ã€äº¤äº’æµç¨‹è®¾è®¡

### 5.1 åˆ›å»ºæ ‡æ³¨æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"æ ‡æ³¨"æŒ‰é’®
   â†“
2. è¿›å…¥æ ‡æ³¨æ¨¡å¼ï¼ˆé¼ æ ‡å˜ä¸ºåå­—ï¼‰
   â†“
3. ç”¨æˆ·åœ¨å›¾ç‰‡ä¸Šæ‹–æ‹½åˆ›å»ºçŸ©å½¢æ¡†
   â†“
4. é‡Šæ”¾é¼ æ ‡ï¼Œå¼¹å‡ºæ ‡æ³¨å±æ€§å¯¹è¯æ¡†
   â†“
5. ç”¨æˆ·å¡«å†™ï¼š
   - æ ‡æ³¨ç±»å‹ï¼ˆå­—æ®µ/Logo/æ­£åˆ™ï¼‰
   - æ ‡æ³¨åç§°
   - å…³è”å­—æ®µï¼ˆå¦‚æœæ˜¯å­—æ®µç±»å‹ï¼‰
   - æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¦‚æœæ˜¯æ­£åˆ™ç±»å‹ï¼‰
   â†“
6. ç‚¹å‡»"ç¡®å®š"ï¼Œåˆ›å»ºæ ‡æ³¨
   â†“
7. æ ‡æ³¨æ˜¾ç¤ºåœ¨ç”»å¸ƒå’Œåˆ—è¡¨ä¸­
```

### 5.2 ç¼–è¾‘æ ‡æ³¨æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»æ ‡æ³¨æ¡†æˆ–åˆ—è¡¨é¡¹
   â†“
2. æ ‡æ³¨æ¡†é«˜äº®ï¼Œæ˜¾ç¤ºæ§åˆ¶ç‚¹
   â†“
3. ç”¨æˆ·æ“ä½œï¼š
   - æ‹–æ‹½æ§åˆ¶ç‚¹ï¼šè°ƒæ•´å¤§å°
   - æ‹–æ‹½æ ‡æ³¨æ¡†ï¼šç§»åŠ¨ä½ç½®
   - åŒå‡»ï¼šæ‰“å¼€å±æ€§å¯¹è¯æ¡†
   â†“
4. ä¿®æ”¹å±æ€§åä¿å­˜
```

### 5.3 å­—æ®µå…³è”æµç¨‹

```
1. ç”¨æˆ·åˆ›å»ºæˆ–ç¼–è¾‘å­—æ®µæ ‡æ³¨
   â†“
2. åœ¨å±æ€§å¯¹è¯æ¡†ä¸­é€‰æ‹©"å…³è”å­—æ®µ"
   â†“
3. ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©æ¨¡æ¿å­—æ®µ
   â†“
4. ç³»ç»ŸéªŒè¯ï¼š
   - å­—æ®µæ˜¯å¦å­˜åœ¨
   - æ˜¯å¦å·²è¢«å…¶ä»–æ ‡æ³¨å…³è”ï¼ˆå¯é€‰ï¼‰
   â†“
5. ä¿å­˜å…³è”å…³ç³»
   â†“
6. æ ‡æ³¨åˆ—è¡¨æ˜¾ç¤ºå…³è”çŠ¶æ€
```

---

## ğŸ“ å…­ã€UIç»„ä»¶è®¾è®¡

### 6.1 å·¥å…·æ ç»„ä»¶

```tsx
<AnnotationToolbar>
  <ToolGroup>
    <ToolButton icon="select" active={tool === 'select'} />
    <ToolButton icon="annotate" active={tool === 'annotate'} />
    <ToolButton icon="delete" active={tool === 'delete'} />
  </ToolGroup>
  
  <Divider />
  
  <ZoomControls>
    <Button onClick={zoomOut}>-</Button>
    <Text>{Math.round(scale * 100)}%</Text>
    <Button onClick={zoomIn}>+</Button>
    <Button onClick={fitToWindow}>é€‚åº”çª—å£</Button>
  </ZoomControls>
  
  <Divider />
  
  <ActionButtons>
    <Button onClick={clearAll}>æ¸…ç©ºæ‰€æœ‰</Button>
    <Button onClick={exportAnnotations}>å¯¼å‡º</Button>
  </ActionButtons>
</AnnotationToolbar>
```

### 6.2 æ ‡æ³¨ç”»å¸ƒç»„ä»¶

```tsx
<AnnotationCanvas>
  {/* èƒŒæ™¯å›¾ç‰‡ */}
  <ImageLayer src={imageUrl} />
  
  {/* æ ‡æ³¨å±‚ */}
  <AnnotationLayer>
    {annotations.map(annotation => (
      <AnnotationBox
        key={annotation.id}
        annotation={annotation}
        selected={selectedAnnotationId === annotation.id}
        onSelect={() => setSelectedAnnotationId(annotation.id)}
        onUpdate={handleAnnotationUpdate}
        onDelete={handleAnnotationDelete}
      />
    ))}
  </AnnotationLayer>
  
  {/* äº¤äº’å±‚ */}
  <InteractionLayer
    tool={currentTool}
    onAnnotationCreate={handleAnnotationCreate}
  />
</AnnotationCanvas>
```

### 6.3 æ ‡æ³¨å±æ€§å¯¹è¯æ¡†

```tsx
<AnnotationDialog open={dialogOpen}>
  <DialogHeader>
    <DialogTitle>
      {editingAnnotation ? 'ç¼–è¾‘æ ‡æ³¨' : 'æ–°å»ºæ ‡æ³¨'}
    </DialogTitle>
  </DialogHeader>
  
  <DialogBody>
    <Field label="æ ‡æ³¨ç±»å‹">
      <Select value={type} onChange={setType}>
        <option value="field">å­—æ®µæ ‡æ³¨</option>
        <option value="logo">Logoæ ‡æ³¨</option>
        <option value="regex">æ­£åˆ™åŒºåŸŸ</option>
      </Select>
    </Field>
    
    <Field label="æ ‡æ³¨åç§°">
      <Input value={label} onChange={setLabel} />
    </Field>
    
    {type === 'field' && (
      <Field label="å…³è”å­—æ®µ">
        <Select value={fieldId} onChange={setFieldId}>
          <option value="">æœªå…³è”</option>
          {fields.map(field => (
            <option key={field.id} value={field.id}>
              {field.field_name}
            </option>
          ))}
        </Select>
      </Field>
    )}
    
    {type === 'regex' && (
      <Field label="æ­£åˆ™è¡¨è¾¾å¼">
        <Input value={regexPattern} onChange={setRegexPattern} />
      </Field>
    )}
    
    <Field label="åæ ‡ä¿¡æ¯">
      <Text fontSize="sm" color="gray.600">
        X: {x}, Y: {y}, å®½: {width}, é«˜: {height}
      </Text>
    </Field>
  </DialogBody>
  
  <DialogFooter>
    <Button onClick={handleCancel}>å–æ¶ˆ</Button>
    <Button onClick={handleSave} colorScheme="blue">ä¿å­˜</Button>
  </DialogFooter>
</AnnotationDialog>
```

---

## ğŸ”§ ä¸ƒã€å®ç°å»ºè®®

### 7.1 æ¨èæŠ€æœ¯æ ˆ

1. **Canvasæ¸²æŸ“**
   - ä½¿ç”¨HTML5 Canvas API
   - ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼Œæ”¯æŒå¤æ‚ç»˜åˆ¶
   - ç¼ºç‚¹ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†äº¤äº’

2. **SVGè¦†ç›–å±‚**
   - ä½¿ç”¨SVGå…ƒç´ è¦†ç›–å›¾ç‰‡
   - ä¼˜ç‚¹ï¼šDOMæ“ä½œç®€å•ï¼ŒCSSæ ·å¼æ”¯æŒ
   - ç¼ºç‚¹ï¼šæ€§èƒ½ç•¥å·®äºCanvas

3. **React-Konva**ï¼ˆæ¨èï¼‰
   - åŸºäºCanvasçš„Reactåº“
   - ä¼˜ç‚¹ï¼šReactç»„ä»¶åŒ–ï¼Œæ€§èƒ½å¥½ï¼ŒåŠŸèƒ½å¼ºå¤§
   - ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–ä¾èµ–

### 7.2 æ¨èæ–¹æ¡ˆï¼šReact-Konva

```tsx
import { Stage, Layer, Image, Rect, Text } from 'react-konva'

<Stage width={800} height={600}>
  <Layer>
    <Image image={imageRef} />
    {annotations.map(ann => (
      <Rect
        key={ann.id}
        x={ann.x}
        y={ann.y}
        width={ann.width}
        height={ann.height}
        stroke={ann.color}
        strokeWidth={2}
        draggable
        onDragEnd={(e) => handleAnnotationMove(ann.id, e.target.position())}
        onTransformEnd={(e) => handleAnnotationResize(ann.id, e.target.getAttrs())}
      />
    ))}
  </Layer>
</Stage>
```

### 7.3 å®ç°æ­¥éª¤

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šåŸºç¡€é¢„è§ˆå’Œæ ‡æ³¨
   - å®ç°å›¾ç‰‡é¢„è§ˆ
   - å®ç°åŸºç¡€çŸ©å½¢æ ‡æ³¨
   - å®ç°æ ‡æ³¨çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤

2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå¢å¼ºåŠŸèƒ½
   - æ·»åŠ æ ‡æ³¨ç±»å‹åŒºåˆ†
   - å®ç°å­—æ®µå…³è”
   - æ·»åŠ æ ‡æ³¨åˆ—è¡¨

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šä¼˜åŒ–ä½“éªŒ
   - æ·»åŠ ç¼©æ”¾å’Œå¹³ç§»
   - ä¼˜åŒ–äº¤äº’åé¦ˆ
   - æ·»åŠ å¿«æ·é”®æ”¯æŒ

---

## ğŸ“ å…«ã€å…³é”®å®ç°ç»†èŠ‚

### 8.1 åæ ‡è½¬æ¢

```typescript
// è®¡ç®—æ ‡æ³¨æ¡†åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼ˆè€ƒè™‘ç¼©æ”¾å’Œåç§»ï¼‰
function getScreenRect(annotation: Annotation, scale: number, offset: {x: number, y: number}) {
  return {
    x: annotation.x * scale + offset.x,
    y: annotation.y * scale + offset.y,
    width: annotation.width * scale,
    height: annotation.height * scale
  }
}

// å°†å±å¹•åæ ‡è½¬æ¢ä¸ºå›¾ç‰‡åæ ‡
function screenToImage(screenX: number, screenY: number, scale: number, offset: {x: number, y: number}) {
  return {
    x: (screenX - offset.x) / scale,
    y: (screenY - offset.y) / scale
  }
}
```

### 8.2 æ ‡æ³¨ç¢°æ’æ£€æµ‹

```typescript
// æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨æ ‡æ³¨æ¡†å†…
function isPointInAnnotation(x: number, y: number, annotation: Annotation): boolean {
  return x >= annotation.x &&
         x <= annotation.x + annotation.width &&
         y >= annotation.y &&
         y <= annotation.y + annotation.height
}

// è·å–é¼ æ ‡ä½ç½®ä¸‹çš„æ ‡æ³¨ï¼ˆä»åå¾€å‰æ£€æŸ¥ï¼Œåç»˜åˆ¶çš„åœ¨ä¸Šå±‚ï¼‰
function getAnnotationAtPoint(x: number, y: number, annotations: Annotation[]): Annotation | null {
  for (let i = annotations.length - 1; i >= 0; i--) {
    if (isPointInAnnotation(x, y, annotations[i])) {
      return annotations[i]
    }
  }
  return null
}
```

### 8.3 æ ‡æ³¨æ¡†è°ƒæ•´å¤§å°

```typescript
// 8ä¸ªæ§åˆ¶ç‚¹çš„ä½ç½®
const controlPoints = [
  { x: annotation.x, y: annotation.y }, // å·¦ä¸Š
  { x: annotation.x + annotation.width / 2, y: annotation.y }, // ä¸Šä¸­
  { x: annotation.x + annotation.width, y: annotation.y }, // å³ä¸Š
  { x: annotation.x + annotation.width, y: annotation.y + annotation.height / 2 }, // å³ä¸­
  { x: annotation.x + annotation.width, y: annotation.y + annotation.height }, // å³ä¸‹
  { x: annotation.x + annotation.width / 2, y: annotation.y + annotation.height }, // ä¸‹ä¸­
  { x: annotation.x, y: annotation.y + annotation.height }, // å·¦ä¸‹
  { x: annotation.x, y: annotation.y + annotation.height / 2 }, // å·¦ä¸­
]

// æ ¹æ®æ‹–æ‹½çš„æ§åˆ¶ç‚¹æ›´æ–°æ ‡æ³¨æ¡†
function resizeAnnotation(
  annotation: Annotation,
  controlPointIndex: number,
  newX: number,
  newY: number
): Annotation {
  // æ ¹æ®æ§åˆ¶ç‚¹ç´¢å¼•è®¡ç®—æ–°çš„ä½ç½®å’Œå¤§å°
  // ...
}
```

---

## âœ… ä¹ã€æœ€ä½³å®è·µå»ºè®®

### 9.1 æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ `useMemo` ç¼“å­˜è®¡ç®—ç»“æœ
- ä½¿ç”¨ `useCallback` ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°
- å¤§é‡æ ‡æ³¨æ—¶ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- Canvasç»˜åˆ¶ä½¿ç”¨ `requestAnimationFrame`

### 9.2 ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æ·»åŠ åŠ è½½çŠ¶æ€æç¤º
- æ·»åŠ æ“ä½œæ’¤é”€/é‡åšåŠŸèƒ½
- æ·»åŠ å¿«æ·é”®æ”¯æŒï¼ˆDeleteåˆ é™¤ï¼ŒEscå–æ¶ˆï¼‰
- æ·»åŠ æ“ä½œæç¤ºå’Œå¼•å¯¼

### 9.3 é”™è¯¯å¤„ç†
- å›¾ç‰‡åŠ è½½å¤±è´¥å¤„ç†
- æ ‡æ³¨åæ ‡è¶Šç•Œæ£€æŸ¥
- å­—æ®µå…³è”éªŒè¯
- ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†

---

## ğŸ¨ åã€UIè®¾è®¡å»ºè®®

### 10.1 é¢œè‰²æ–¹æ¡ˆ
- **å­—æ®µæ ‡æ³¨**ï¼šè“è‰² (#3B82F6)
- **Logoæ ‡æ³¨**ï¼šç»¿è‰² (#10B981)
- **æ­£åˆ™æ ‡æ³¨**ï¼šæ©™è‰² (#F59E0B)
- **é€‰ä¸­çŠ¶æ€**ï¼šçº¢è‰² (#EF4444)
- **èƒŒæ™¯**ï¼šæµ…ç°è‰² (#F7FAFC)

### 10.2 äº¤äº’åé¦ˆ
- **æ‚¬åœæ•ˆæœ**ï¼šæ ‡æ³¨æ¡†é«˜äº®
- **é€‰ä¸­æ•ˆæœ**ï¼šæ ‡æ³¨æ¡†åŠ ç²—ï¼Œæ˜¾ç¤ºæ§åˆ¶ç‚¹
- **æ‹–æ‹½åé¦ˆ**ï¼šåŠé€æ˜é¢„è§ˆ
- **æ“ä½œæç¤º**ï¼šToasté€šçŸ¥

---

## ğŸ“¦ åä¸€ã€ç»„ä»¶æ‹†åˆ†å»ºè®®

å»ºè®®å°†åŠŸèƒ½æ‹†åˆ†ä¸ºä»¥ä¸‹ç‹¬ç«‹ç»„ä»¶ï¼š

1. **InvoiceAnnotationEditor** - ä¸»å®¹å™¨ç»„ä»¶
2. **AnnotationCanvas** - æ ‡æ³¨ç”»å¸ƒç»„ä»¶
3. **AnnotationToolbar** - å·¥å…·æ ç»„ä»¶
4. **AnnotationList** - æ ‡æ³¨åˆ—è¡¨ç»„ä»¶
5. **AnnotationDialog** - æ ‡æ³¨å±æ€§å¯¹è¯æ¡†
6. **FieldAssociationPanel** - å­—æ®µå…³è”é¢æ¿
7. **ZoomControls** - ç¼©æ”¾æ§åˆ¶ç»„ä»¶

è¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ã€‚

